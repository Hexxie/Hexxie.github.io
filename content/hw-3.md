Title: Хроники hw: encoder, uart
Date: 2021-02-18 19:35
Category: Hardware
Tags: hartdware, stm32, pet project, pwm, encoder, uart
Authors: Anastasiia Rusakova
Summary: 3-я часть from zero to hero

Я тут в summary написала from zero to hero. Потому что на самом деле у меня совсем нет никакого бекграуна в hardware. Все что я тут описываю - я делаю впервые. И схему тоже собираю впервые. Тем интереснее.

![uart]({static}images/hw-3.jpg)

Вчера мне пришли новые элементы и я решила начать с простого: изменять энкодером яркость светодиода.
Это у меня получилось прям сходу, потому что как оказалось в stm32 таймера поддерживают encoder mode и сube сетапит как раз 2 пина. Т.е. 3 клика, вцепил 2 проводка, написал три строки типа так:

'''
if(TIM2->CNT < 1023)
{
  LED_DutyCycle = ((TIM2->CNT)<<6);
}
TIM1->CCR1 = LED_DutyCycle;
HAL_Delay(10);

'''

и готово. В кратце у меня есть 2 таймера. Один - ШИМ, второй - энкодер. Таймер шима работает через сравнение с CCR1 регистром. Соответсвенно каждый поворот энкодера - увеличивает или уменьшает число счетчика, записанное в CCR1 регистр.

Дальше я увидела, что люди как-то в своих туториалах выводят логи в юарт. Юарта у меня нет, но мне очень захотелось. Обычно у людей есть переходник uart-to-usb от ftdi. Но конечно же не у меня. Зато у меня есть ардуино.
Я нашла [статью](https://istarik.ru/blog/stm32/111.html), которая описывает как прошить стмку через юарт. Прошиваться через юарт мне пока рано (но скоро пробну), но здесь описано как превратить ардуино в конвертер.

Примерно так:

'''
void setup()
{
   pinMode(0, INPUT);
   pinMode(1, INPUT);
}
 void loop()
{}

'''
Потом настраивает в кубе юарт и подключаемся проводами. TX -> RX, RX -> TX.

У меня была веселая история, связанная с юартом на самом деле. Я не знала про TX -> RX особенность и думала что нет разницы как подключать. У меня часто возникала ситуация на работе, что я не могла подключить плату. Ну т.е. плату я подключала но логи не работали. Я тогда звала коллегу и он...мм..мне казалось что он сильнее прижимал коннектор. В общем я так и делала, когда у меня не работало, но к успеху я так и не приходила -> приходилось часто звать коллегу. И вот мне сейчас интересно, он реально не выкупал, что я не шарю, что сторона важна или прикалывался.
К чему я веду. Нежданно негаданно приехал карантин, платы пришлось забрать домой. И тут я столкнулась со своей любимй проблемой. Подключаю я плату, а логи не идут. Я уже прижимаю те коннекторы как могу, и тут парень спрашивает "а ты шаришь что юарт напревленный?". Я такая "в смысле?" - "TX -> RX, RX -> TX, имеет значение какой стороной ты подключаешь". В общем перевернула я коннектор, и все заработало.

Что я хочу сказать? А то что поделки своми руками очень полезны, так что советую всем интересующимся сесть за комп и что-то сделать =)

P.S. Вовчик, если ты это читаешь и хочешь свою ардуинку обратно - напиши и я вышлю НП =) или отдам при встрече =)

[Код здесь](https://github.com/Hexxie/stm32-workaraunds/tree/main/encoder)
