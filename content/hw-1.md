Title: Dig into hw programming
Date: 2021-02-15 17:02
Category: Hardware
Tags: hartdware, stm32, pet project
Authors: Anastasiia Rusakova
Summary: Первое знакомство с программированием stm32

Наконееец-то я занялась этим долгожданным многопродуманным проектом!
Концепция и реквайрменты - это секрет. Я буду описывать только инсайты, а потом соберу свой прогресс когда проект будет закончен.

![Hello World setup]({static}images/hw-1.jpg)

Я так давно хотела попробовать кодить под stm32. А еще мне в прошлом году так свезло - я научилась паять. Так что теперь ничего не останавливает меня взяться за этот проект. Опыт программирования есть, опыт пайки - тоже.

Сегодня что-то типа традиционного "Hello world". Знакомство с инструментарием, первые подключения внешней периферии.
Я скачала официальные stm cube и keil uVision. И вот куб зашел мне больше. Особенно прикольная генерация кода и раскладка пинов. Правда я уже успела все зафейлить)) об это подробнее.

Нарисовала я значит схему. Бест практис инженерии - сначала дизайн - потом лепим все остальное. Подключила, что можно, к макетке. Проводки напряжения и земли решила подпаять, так как работать нам с ними еще долго.

Ну а дальше началось творчество. Вообще тот факт что куб прописывает много генеренки мне не понравилось. Это ж по сути с генеренным кодом еще расчехляться придется. Ну для Hello World сойдет. Перешла я на вкладку конфигурации контроллера, а там пины можно прям через гуи настроить.

![Device Configuration]({static}images/hw-1-1.jpg)

Метод тыка наше все. Пины я все ресетнула. Ну а зачем, мне же только светодиод подключить. Хватит и одного.
Сгенерило оно инит моего пина. Я дописала toggle с задержкой в 2 секунды. Флешим. Ура работает!

Ну крутяк! Я решила уменьшить задержку между мигалкой. А оно не прошивается... пишет типа st-link не видит. Но он подключен, горит, серийник получает.
st-link - это внешний дебагер, через него микроконтроллер шьется. Не знаю может в stm32 есть еще способы типа через uart, но st-link - самый простой случай.

Пошла я гуглить. Одни пишут к ресету stlink-а подключится, другие - напряжения не хватает. Щитооо... еще был комментарий типа в настройках указать Connect under reset. Но у меня оно и так быть указано. В одном из комментариев было описано что-то типа "...оно не хочет прошивать когда контроллер раннит программу...". И тут я решила попробовать прошить с зажатым ресетом.

Смекалка и метод тыка наше все. К st-link мы подключились, но прошиваться все равно не хочет. Новая ошибка - уже прогресс: Debugger connected Target is not responding, retrying...
Гуглю. Первая ссылка. Оказалось не стоило все пины ресетать.

> So as soon as the new program is flashed the SWD connection goes dead. I guess the mbed program retains the use of SWD on the standard pins by default so it was never an ssue there.

Вернула назад пины для sw дебага и все теперь работает. Иначе нужно было, используя ресет, стирать прошивку в st-link утилите и заново прошиваться.

Хотелось бы написать здесь вывод - не трогай то, что не знаешь. Но...я бы и не узнала =)
Лучше скажу так: запоминай то что делаешь. Чтоб знать как гуглить. Ну а я пошла дальше играться)

[Спасибо стековерфлову.](https://stackoverflow.com/questions/60827602/stm32cubeide-can-only-flash-once-no-swd-debugging)
